SET(DESTDIR $ENV{DESTDIR})

MESSAGE(STATUS "Installing R support packages")

IF(WIN32)
	SET(R_LIBDIR @R_LIBDIR@)
	IF(DESTDIR)
		# strip drive letter
		STRING(REGEX REPLACE "^.:." "" R_LIBDIR ${R_LIBDIR})
		SET(R_LIBDIR "${DESTDIR}/${R_LIBDIR}")
		FILE(MAKE_DIRECTORY "${R_LIBDIR}")
	ENDIF(DESTDIR)
	EXECUTE_PROCESS(
		COMMAND @R_EXECUTABLE@ CMD INSTALL -c -l ${R_LIBDIR} "@CMAKE_CURRENT_SOURCE_DIR@/rkward" "@CMAKE_CURRENT_SOURCE_DIR@/rkwardtests"
		WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
		RESULT_VARIABLE R_LIB_INSTALL_EXIT_CODE
	)
ELSE(WIN32)
	EXECUTE_PROCESS(
		COMMAND mkdir -p @CMAKE_CURRENT_BINARY_DIR@/tmp ${DESTDIR}/@R_LIBDIR@
	)
	EXECUTE_PROCESS(
		COMMAND env TMPDIR=@CMAKE_CURRENT_BINARY_DIR@/tmp @R_EXECUTABLE@ CMD INSTALL -c -l ${DESTDIR}/@R_LIBDIR@ "@CMAKE_CURRENT_SOURCE_DIR@/rkward" "@CMAKE_CURRENT_SOURCE_DIR@/rkwardtests"
		WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
		RESULT_VARIABLE R_LIB_INSTALL_EXIT_CODE
	)
ENDIF(WIN32)

IF(R_LIB_INSTALL_EXIT_CODE)
	MESSAGE (SEND_ERROR "Failed to install R support libraries. Please make sure you have the required permissions.")
ENDIF(R_LIB_INSTALL_EXIT_CODE)
